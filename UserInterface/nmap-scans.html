<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NMAP Scans</title>
  <style>
    body {
      margin: 0;
      font-family: 'Courier New', Courier, monospace;
      background-color: #0d1117;
      color: #c9d1d9;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(90deg, #3a3f44, #1e2228);
      padding: 15px 30px;
      border-bottom: 2px solid #ff4d4d;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
    }
    .company-name a {
      text-decoration: none;
      color: #ff4d4d;
      font-size: 2em;
      font-weight: bold;
      text-shadow: 0 0 8px #ff4d4d, 0 0 16px #ff4d4d;
      transition: transform 0.3s, text-shadow 0.3s;
    }
    .company-name a:hover {
      transform: scale(1.1);
      text-shadow: 0 0 12px #ff4d4d, 0 0 24px #ff4d4d;
    }
    .nav-links {
      display: flex;
      gap: 20px;
    }
    .nav-links a {
      text-decoration: none;
      color: #c9d1d9;
      font-size: 1em;
      font-weight: bold;
      padding: 8px 16px;
      border-radius: 10px;
      background: rgba(255, 77, 77, 0.1);
      transition: all 0.3s;
    }
    .nav-links a:hover {
      background: rgba(255, 77, 77, 0.2);
      color: #ff4d4d;
      transform: translateY(-3px);
      box-shadow: 0 0 8px #ff4d4d;
    }
    .nmap-scans {
      display: flex;
      padding: 20px;
      gap: 20px;
      flex: 1;
    }
    .configuration {
      flex: 1;
    }
    .output-box {
      flex: 1;
      padding: 20px;
      background: rgba(255, 77, 77, 0.1);
      border: 2px solid #ff4d4d;
      border-radius: 10px;
      color: #ff4d4d;
      font-family: 'Courier New', Courier, monospace;
      overflow-y: auto;
      white-space: pre-wrap;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
    }
    .scan-section {
      margin-bottom: 30px;
      position: relative;
    }
    .scan-section h2 {
      margin-bottom: 10px;
      color: #ff4d4d;
    }
    .help-icon {
      margin-left: 8px;
      cursor: pointer;
      color: #ff4d4d;
      font-weight: bold;
      border: 1px solid #ff4d4d;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      text-align: center;
      display: inline-block;
      font-size: 12px;
    }
    .help-text {
      display: none;
      background-color: #1e2228;
      color: #c9d1d9;
      border: 1px solid #ff4d4d;
      border-radius: 8px;
      padding: 10px;
      margin-top: 10px;
      font-size: 0.9em;
    }
    .scan-section input[type="radio"],
    .scan-section input[type="checkbox"] {
      display: none;
    }
    .scan-section label {
      display: block;
      margin: 10px 0;
      cursor: pointer;
      padding: 10px;
      border: 2px solid #ff4d4d;
      border-radius: 10px;
      text-align: center;
      background: rgba(255, 77, 77, 0.1);
      color: #c9d1d9;
      transition: all 0.3s;
    }
    .scan-section label:hover {
      background: rgba(255, 77, 77, 0.2);
      box-shadow: 0 0 8px #ff4d4d;
    }
    .scan-section input[type="radio"]:checked + label,
    .scan-section input[type="checkbox"]:checked + label {
      background: rgba(255, 77, 77, 0.3);
      color: #ff4d4d;
    }
    #command-line {
      margin-top: 20px;
      padding: 10px;
      width: 100%;
      font-family: 'Courier New', Courier, monospace;
      color: #c9d1d9;
      background: #1e2228;
      border: 2px solid #ff4d4d;
      border-radius: 10px;
    }
    footer {
      text-align: center;
      padding: 10px;
      background: linear-gradient(90deg, #3a3f44, #1e2228);
      border-top: 2px solid #ff4d4d;
      color: #c9d1d9;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  {% include 'header.html' %}
  <main class="nmap-scans">
    <div class="configuration">
      <!-- What is NMAP? -->
      <div class="scan-section">
        <h2>What is NMAP? <span class="help-icon" onclick="toggleHelp('nmap-info')">?</span></h2>
        <div class="help-text" id="nmap-info">
          <strong>Nmap (Network Mapper)</strong> is a powerful open-source tool used to discover hosts and services on a computer network. It works by sending packets and analyzing responses to:
          <ul>
            <li>Identify active devices on a network</li>
            <li>Detect open ports and running services</li>
            <li>Determine operating system types</li>
            <li>Uncover vulnerabilities and misconfigurations</li>
          </ul>
          Often used by network administrators and cybersecurity professionals, Nmap is essential for security auditing and network inventory.
        </div>
      </div>

      <h1>Configure Your NMAP Scan</h1>

      <!-- Quick Scan Options -->
      <div class="scan-section">
        <h2>Quick Scan Options <span class="help-icon" onclick="toggleHelp('quick-help')">?</span></h2>
        <select id="quick-options-select">
          <option value="">Select a quick scan option</option>
          <option value="-sP">Ping Scan (-sP): Host discovery only</option>
          <option value="-sS">SYN Scan (-sS): Stealth port scan (fast, default)</option>
          <option value="-sU">UDP Scan (-sU): Scan for open UDP ports</option>
          <option value="-A">Aggressive Scan (-A): OS detection, version, scripts, traceroute</option>
        </select>
        <div class="help-text" id="quick-help">
          <strong>Ping Scan (-sP):</strong> Determines which hosts are online by sending ICMP Echo Requests and sometimes TCP packets. It doesn't scan ports—only checks host availability. Useful for quickly mapping active devices.<br>

          <strong>SYN Scan (-sS):</strong> Performs a stealthy TCP port scan using half-open connections. It sends a SYN and listens for a SYN-ACK to detect open ports, then immediately resets the connection without completing the handshake. Effective and less likely to be logged.<br>

          <strong>UDP Scan (-sU):</strong> Scans for open UDP ports by sending UDP packets and analyzing responses or lack thereof. It’s slower and harder to interpret than TCP scans but essential for identifying services like DNS, SNMP, and DHCP.<br>

          <strong>Aggressive Scan (-A):</strong> Combines OS detection, version detection, script scanning, and traceroute. Provides detailed information about the target system but generates noticeable traffic. Best used for deep reconnaissance when stealth isn't required.<br>
        </div>

      </div>

      <!-- Target IP Address -->
      <div class="scan-section">
        <h2>Target IP Address <span class="help-icon" onclick="toggleHelp('ip-help')">?</span></h2>
        <input type="text" id="ip-input" placeholder="Enter IP address here" />
        <div class="help-text" id="ip-help">
          Enter the IP address or hostname of the target system you want to scan.
        </div>
      </div>

      <!-- Port Range -->
      <div class="scan-section">
        <h2>Port Range <span class="help-icon" onclick="toggleHelp('port-help')">?</span></h2>
        <input type="checkbox" id="custom-ports" />
        <label for="custom-ports">Custom Range</label>
        <input type="text" id="port-input" placeholder="Enter port range (e.g., 1-1000)" />
        <div class="help-text" id="port-help">
          Define a custom range of ports to scan (e.g., 1-1000). If unchecked, Nmap will use default port settings.
        </div>
      </div>

      <!-- Custom Scan Options -->
      <div class="scan-section">
        <h2>Custom Scan Options <span class="help-icon" onclick="toggleHelp('custom-help')">?</span></h2>
        <input type="checkbox" id="verbose" value="-v" />
        <label for="verbose">Verbose</label>

        <input type="checkbox" id="os-detection" value="-O" />
        <label for="os-detection">OS Detection</label>

        <input type="checkbox" id="service-detection" value="-sV" />
        <label for="service-detection">Service/Version Detection</label>

        <h3>Scan Speed <span class="help-icon" onclick="toggleHelp('speed-help')">?</span></h3>
        <select id="speed">
          <option value="">Default</option>
          <option value="-T0">T0 (Slowest)</option>
          <option value="-T1">T1</option>
          <option value="-T2">T2</option>
          <option value="-T3">T3 (Default)</option>
          <option value="-T4">T4</option>
          <option value="-T5">T5 (Fastest)</option>
        </select>

        <div class="help-text" id="custom-help">
          <strong>Verbose (-v):</strong> Shows more output during scanning.<br>
          <strong>OS Detection (-O):</strong> Attempts to determine the OS of the target.<br>
          <strong>Service/Version Detection (-sV):</strong> Detects the service name and version on ports.
        </div>
        <div class="help-text" id="speed-help">
          Scan timing template from T0 (Paranoid) to T5 (Insane). Higher numbers are faster but noisier.
        </div>
      </div>

      <!-- Command Preview -->
      <textarea id="command-line" rows="2" readonly></textarea>
      <button id="run-scan-button" disabled>Run Scan</button>
      <p id="scan-status">Scan not ready</p>
    </div>

    <div class="output-box" id="output">
      Results will appear here
    </div>
  </main>
  <footer>
    <p>&copy; <span id="current-year"></span> Seige Engine | Contact: <a href="mailto:nicolas.domico@stvincent.edu">nicolas.domico@stvincen.edu</a></p>
  </footer>

  <script>
    const ipInput = document.getElementById('ip-input');
    const quickOptions = document.getElementById('quick-options-select');
    const verbose = document.getElementById('verbose');
    const osDetection = document.getElementById('os-detection');
    const serviceDetection = document.getElementById('service-detection');
    const speed = document.getElementById('speed');
    const portCheckbox = document.getElementById('custom-ports');
    const portInput = document.getElementById('port-input');
    const commandLine = document.getElementById('command-line');
    const outputBox = document.getElementById('output');
    const runScanButton = document.getElementById('run-scan-button');
    const scanStatus = document.getElementById('scan-status');
    const currentYear = document.getElementById('current-year');

    currentYear.textContent = new Date().getFullYear();

    function updateCommandLine() {
      const ip = ipInput.value.trim();
      const quickOption = quickOptions.value;
      if (quickOption) {
        commandLine.value = `nmap ${quickOption} ${ip}`.trim();
        return;
      }
      const options = [
        verbose.checked ? verbose.value : '',
        osDetection.checked ? osDetection.value : '',
        serviceDetection.checked ? serviceDetection.value : '',
        speed.value
      ].filter(Boolean).join(' ');
      const ports = portCheckbox.checked ? `-p ${portInput.value.trim()}` : '';
      commandLine.value = `nmap ${options} ${ports} ${ip}`.trim();
    }

    function updateRunButton() {
      const ip = ipInput.value.trim();
      const isReady = ip && commandLine.value.trim();
      runScanButton.disabled = !isReady;
      scanStatus.textContent = isReady ? 'Scan ready to run' : 'Scan not ready';
      scanStatus.style.color = isReady ? 'green' : 'red';
    }

    function toggleHelp(id) {
      const el = document.getElementById(id);
      el.style.display = el.style.display === 'block' ? 'none' : 'block';
    }

    ipInput.addEventListener('input', () => { updateCommandLine(); updateRunButton(); });
    quickOptions.addEventListener('change', () => { updateCommandLine(); updateRunButton(); });
    verbose.addEventListener('change', () => { updateCommandLine(); updateRunButton(); });
    osDetection.addEventListener('change', () => { updateCommandLine(); updateRunButton(); });
    serviceDetection.addEventListener('change', () => { updateCommandLine(); updateRunButton(); });
    speed.addEventListener('change', () => { updateCommandLine(); updateRunButton(); });
    portCheckbox.addEventListener('change', () => { updateCommandLine(); updateRunButton(); });
    portInput.addEventListener('input', () => { updateCommandLine(); updateRunButton(); });

    async function loadResults(path) {
            if (!path) {
                outputBox.textContent = "File path not available.";
                return;
            }
            try {
                const response = await fetch(`/get-nmap-results/?path=${encodeURIComponent(path)}`);
                const text = await response.text();
                outputBox.textContent = text || 'No results available.';
            } catch (error) {
                outputBox.textContent = 'Failed to load results.';
            }
        }

        window.onload = () => {
            clearOutputBox();
        };

    const runScanButton = document.getElementById('run-scan-button');
    const scanStatus = document.getElementById('scan-status');

// Enable button if IP and command are valid
function updateRunButton() {
    const ip = ipInput.value.trim();
    const isReady = ip && commandLine.value.trim();
    runScanButton.disabled = !isReady;
    scanStatus.textContent = isReady ? 'Scan ready to run' : 'Scan not ready';
    scanStatus.style.color = isReady ? 'green' : 'red';
}

// Add event listeners to update the run button when inputs change
ipInput.addEventListener('input', updateRunButton);
quickOptions.addEventListener('change', updateRunButton);
verbose.addEventListener('change', updateRunButton);
osDetection.addEventListener('change', updateRunButton);
versionDetection.addEventListener('change', updateRunButton);
speed.addEventListener('change', updateRunButton);
portCheckbox.addEventListener('change', updateRunButton);
portInput.addEventListener('input', updateRunButton);

// Add a click handler for the button (to run the scan)
runScanButton.addEventListener('click', async () => {
    const ip = ipInput.value.trim();
    const ports = portInput.value;
    const cmd = commandLine.value;
    const url = `/run-nmap-scan/?ip=${encodeURIComponent(ip)}&ports=${encodeURIComponent(ports)}&cmd=${encodeURIComponent(cmd)}`;

    try {
        scanStatus.textContent = 'Running scan...';
        scanStatus.style.color = 'orange';

        const response = await fetch(url, {});
        const data = await response.json();

        if (response.ok) {
            const path = data.path;
            scanStatus.textContent = 'Scan completed!';
            scanStatus.style.color = 'green';
            loadResults(path); // Load the scan results after it runs
        } else {
            throw new Error('Scan failed');
        }
    } catch (error) {
        scanStatus.textContent = 'Scan failed';
        scanStatus.style.color = 'red';
    }
});
  </script>
</body>
</html>
